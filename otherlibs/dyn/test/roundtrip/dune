(executable
 (name gen_dyn_tests)
 (modules gen_dyn_tests)
 (libraries pp dyn))

(rule
 (with-stdout-to
  dyn_roundtrip.ml.gen
  (pipe-stdout
   (run ./gen_dyn_tests.exe)
   (run ocamlformat --impl -))))

(rule
 (alias runtest)
 (action
  (diff dyn_roundtrip.ml dyn_roundtrip.ml.gen)))

(library
 (name dyn_roundtrip)
 (modules dyn_roundtrip))
