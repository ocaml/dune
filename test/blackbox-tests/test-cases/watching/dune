(env
 (_
  (binaries ../../utils/ocamlformat.exe)))

(cram
 (deps helpers.sh))

(cram
 (applies_to fmt-test)
 (deps %{bin:ocamlformat}))

(cram
 ; see https://github.com/ocaml/dune/pull/4728
 (enabled_if
  (<> "macosx" %{ocaml-config:system}))
 (applies_to * \ path-pwd))

(cram
 ; see https://github.com/ocaml/dune/pull/4728
 (enabled_if
  (= "macosx" %{ocaml-config:system}))
 (applies_to path-pwd))

(cram
 (applies_to what-dune-watches)
 (deps %{bin:strace}))

(rule
 (alias runtest)
 (enabled_if %{bin-available:shellcheck})
 (deps helpers.sh)
 (action
  (run %{bin:shellcheck} -s bash %{deps})))

;; Disabled due to timeouts

(cram
 (enabled_if false)
 (applies_to watching-eager-concurrent-build-command sigpipe))
